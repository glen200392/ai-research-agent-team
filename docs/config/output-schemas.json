{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AI Research Federation — Output JSON Schemas",
  "description": "Validation schemas for all structured JSON outputs across the three pipeline recipes. Version 2.0.0 — McKinsey Standard.",
  "version": "2.0.0",
  "last_updated": "2026-02-21",

  "definitions": {

    "focus_tech_block": {
      "$id": "#/definitions/focus_tech_block",
      "title": "Weekly Focus Technology Block (Pipeline A, Step 5)",
      "description": "Emitted by AI Research Advisor to signal the week's most important technology for Team B chronicle tracking.",
      "type": "object",
      "required": ["focus_tech", "tech_domain", "why_important"],
      "additionalProperties": false,
      "properties": {
        "focus_tech": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100,
          "description": "Human-readable technology name (e.g. 'Multi-Agent Reasoning', 'MoE Architecture')"
        },
        "tech_domain": {
          "type": "string",
          "enum": ["agent", "reasoning", "architecture", "training", "protocol", "multimodal", "safety", "hardware", "infrastructure"],
          "description": "Domain classification for evolution-graph.json routing"
        },
        "why_important": {
          "type": "string",
          "minLength": 20,
          "maxLength": 300,
          "description": "One sentence explaining why this technology matters this week"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Optional: model confidence in this selection (0.0-1.0)"
        }
      }
    },

    "lesson_level1": {
      "$id": "#/definitions/lesson_level1",
      "title": "Level 1 Beginner Lesson Output (Pipeline C, Step 2)",
      "type": "object",
      "required": ["topic", "level1_content"],
      "additionalProperties": false,
      "properties": {
        "topic": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100,
          "description": "Canonical technology topic name, shared across all three levels"
        },
        "level1_content": {
          "type": "string",
          "minLength": 400,
          "maxLength": 2000,
          "description": "Full beginner lesson content in Traditional Chinese Markdown"
        },
        "target_audience": {
          "type": "string",
          "default": "general_public",
          "description": "Intended reader segment"
        },
        "word_count": {
          "type": "integer",
          "minimum": 400,
          "maximum": 600
        }
      }
    },

    "lesson_level2": {
      "$id": "#/definitions/lesson_level2",
      "title": "Level 2 Intermediate Lesson Output (Pipeline C, Step 3)",
      "type": "object",
      "required": ["topic", "level2_content"],
      "additionalProperties": false,
      "properties": {
        "topic": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100
        },
        "level2_content": {
          "type": "string",
          "minLength": 1000,
          "maxLength": 6000,
          "description": "Full intermediate lesson with terminology, code examples, and references"
        },
        "has_code_example": {
          "type": "boolean",
          "description": "Validation flag: must be true (lesson must include Python code block)"
        },
        "word_count": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 1500
        }
      }
    },

    "lesson_level3": {
      "$id": "#/definitions/lesson_level3",
      "title": "Level 3 Expert Lesson Output (Pipeline C, Step 4)",
      "type": "object",
      "required": ["topic", "level3_content"],
      "additionalProperties": false,
      "properties": {
        "topic": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100
        },
        "level3_content": {
          "type": "string",
          "minLength": 2000,
          "maxLength": 12000,
          "description": "Full expert lesson with paper citations, benchmarks, limitations, open questions"
        },
        "citation_count": {
          "type": "integer",
          "minimum": 3,
          "description": "Must cite at least 3 academic papers in APA format"
        },
        "has_comparison_table": {
          "type": "boolean",
          "description": "Validation flag: must include a Markdown comparison table"
        },
        "word_count": {
          "type": "integer",
          "minimum": 2000
        }
      }
    },

    "quiz_output": {
      "$id": "#/definitions/quiz_output",
      "title": "Weekly Quiz JSON Output (Pipeline C, Step 5)",
      "type": "object",
      "required": ["topic", "week", "questions"],
      "additionalProperties": false,
      "properties": {
        "topic": {
          "type": "string",
          "minLength": 2,
          "maxLength": 100
        },
        "week": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "ISO 8601 date string (YYYY-MM-DD)"
        },
        "questions": {
          "type": "array",
          "minItems": 10,
          "maxItems": 10,
          "items": {
            "type": "object",
            "required": ["id", "level", "type", "question", "answer", "explanation"],
            "additionalProperties": false,
            "properties": {
              "id": {
                "type": "integer",
                "minimum": 1,
                "maximum": 10
              },
              "level": {
                "type": "string",
                "enum": ["beginner", "intermediate", "advanced"]
              },
              "type": {
                "type": "string",
                "enum": ["multiple_choice", "true_false", "short_answer"]
              },
              "question": {
                "type": "string",
                "minLength": 10,
                "maxLength": 500
              },
              "options": {
                "type": "array",
                "minItems": 2,
                "maxItems": 4,
                "items": { "type": "string" },
                "description": "Required for multiple_choice and true_false types"
              },
              "answer": {
                "type": "string",
                "minLength": 1,
                "maxLength": 500,
                "description": "Correct answer (letter for MC, T/F for true_false, full answer for short_answer)"
              },
              "explanation": {
                "type": "string",
                "minLength": 20,
                "maxLength": 600,
                "description": "2-3 sentence explanation of why this is correct"
              }
            }
          },
          "description": "Exactly 10 questions: 3 beginner, 4 intermediate, 3 advanced"
        },
        "level_distribution": {
          "type": "object",
          "description": "Auto-computed validation summary",
          "properties": {
            "beginner": { "type": "integer", "const": 3 },
            "intermediate": { "type": "integer", "const": 4 },
            "advanced": { "type": "integer", "const": 3 }
          }
        }
      }
    },

    "team_evaluation": {
      "$id": "#/definitions/team_evaluation",
      "title": "Team Quality Evaluation (Meta Harness, Steps 3-5)",
      "type": "object",
      "required": ["team", "evaluation_month", "scores", "overall_score", "strengths", "improvement_areas", "upgrade_needed"],
      "additionalProperties": false,
      "properties": {
        "team": {
          "type": "string",
          "enum": ["Team A — Current Intelligence", "Team B — Evolution Chronicle", "Team C — Pedagogy Federation"]
        },
        "evaluation_month": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "scores": {
          "type": "object",
          "description": "Dimension scores vary by team (see individual team schemas below)",
          "additionalProperties": {
            "type": "object",
            "required": ["score", "comment"],
            "properties": {
              "score": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100
              },
              "comment": {
                "type": "string",
                "minLength": 10,
                "maxLength": 300
              }
            }
          }
        },
        "overall_score": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "strengths": {
          "type": "array",
          "minItems": 1,
          "maxItems": 5,
          "items": { "type": "string", "minLength": 5 }
        },
        "improvement_areas": {
          "type": "array",
          "minItems": 1,
          "maxItems": 5,
          "items": { "type": "string", "minLength": 5 }
        },
        "upgrade_needed": {
          "type": "boolean"
        },
        "upgrade_suggestion": {
          "type": "string",
          "maxLength": 500,
          "description": "Required when upgrade_needed is true"
        },
        "kpi_trend": {
          "type": "object",
          "description": "Optional: month-over-month score delta",
          "properties": {
            "previous_score": { "type": "integer", "minimum": 0, "maximum": 100 },
            "delta": { "type": "integer", "minimum": -100, "maximum": 100 },
            "trend": { "type": "string", "enum": ["improving", "stable", "declining"] }
          }
        }
      }
    },

    "evolution_node": {
      "$id": "#/definitions/evolution_node",
      "title": "Evolution Graph Node (evolution-graph.json)",
      "type": "object",
      "required": ["id", "label", "year", "domain", "type"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "URL-safe slug identifier"
        },
        "label": { "type": "string", "minLength": 2, "maxLength": 100 },
        "year": { "type": "integer", "minimum": 1950, "maximum": 2030 },
        "domain": {
          "type": "string",
          "enum": ["agent", "reasoning", "architecture", "training", "protocol", "multimodal", "safety", "hardware", "infrastructure"]
        },
        "type": {
          "type": "string",
          "enum": ["paper", "model", "framework", "concept", "milestone", "product"]
        },
        "description": { "type": "string", "maxLength": 500 },
        "source_url": { "type": "string", "format": "uri" },
        "importance": { "type": "integer", "minimum": 1, "maximum": 10 },
        "added_week": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        }
      }
    },

    "evolution_edge": {
      "$id": "#/definitions/evolution_edge",
      "title": "Evolution Graph Edge (evolution-graph.json)",
      "type": "object",
      "required": ["source", "target", "relation"],
      "additionalProperties": false,
      "properties": {
        "source": { "type": "string", "pattern": "^[a-z0-9-]+$" },
        "target": { "type": "string", "pattern": "^[a-z0-9-]+$" },
        "relation": {
          "type": "string",
          "enum": ["evolved_into", "inspired", "replaced", "extended", "merged_with", "challenged_by", "enabled"]
        },
        "strength": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Edge weight (0.0 = weak influence, 1.0 = direct succession)"
        },
        "description": { "type": "string", "maxLength": 200 }
      }
    }
  },

  "validation_rules": {
    "pipeline_a": {
      "step_5_output": { "$ref": "#/definitions/focus_tech_block" }
    },
    "pipeline_c": {
      "step_2_output": { "$ref": "#/definitions/lesson_level1" },
      "step_3_output": { "$ref": "#/definitions/lesson_level2" },
      "step_4_output": { "$ref": "#/definitions/lesson_level3" },
      "step_5_output": { "$ref": "#/definitions/quiz_output" }
    },
    "meta_harness": {
      "step_3_output": { "$ref": "#/definitions/team_evaluation" },
      "step_4_output": { "$ref": "#/definitions/team_evaluation" },
      "step_5_output": { "$ref": "#/definitions/team_evaluation" }
    },
    "evolution_chronicle": {
      "node": { "$ref": "#/definitions/evolution_node" },
      "edge": { "$ref": "#/definitions/evolution_edge" }
    }
  },

  "validation_behavior": {
    "on_schema_violation": "retry_with_stricter_prompt",
    "max_validation_retries": 2,
    "fallback_on_exhausted_retries": "log_error_and_use_raw_text",
    "strict_mode": false,
    "allow_additional_markdown": true,
    "extract_json_from_markdown": true,
    "json_extraction_pattern": "```json\\n([\\s\\S]*?)\\n```"
  }
}
